apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: ping-target
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: ping-target
  template:
    metadata:
      labels:
        app: ping-target
    spec:
      hostNetwork: true
      tolerations:
        - operator: Exists
      containers:
        - name: pinger
          image: registry.k8s.io/busybox:latest
          securityContext:
            privileged: true
          env:
            - name: TARGET_IP
              value: "8.8.8.8"
          command: ["/bin/sh", "-c"]
          args:
            - |
              TARGET="$TARGET_IP"
              echo "Pinging $TARGET every 2s"
              while true; do
                ping -c1 -W1 "$TARGET" && echo "$(date -Is) OK" || echo "$(date -Is) FAIL";
                sleep 2;
              done
