Metadata-Version: 2.4
Name: hpsim
Version: 0.1.0
Summary: Multi-client traffic generator inspired by hping3
Author-email: Kanchan Kumar Jha <kanchankjha@gmail.com>
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: scapy>=2.5
Requires-Dist: psutil>=5.9
Requires-Dist: pyyaml>=6.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10; extra == "dev"
Provides-Extra: extras
Requires-Dist: netifaces>=0.11; extra == "extras"

# hpsim (hping3-inspired simulator)

Python package that simulates many clients on one Linux host, sending hping3-style traffic with spoofed IP/MAC addresses from the same subnet.

## Install

```bash
python3 -m venv .venv
. .venv/bin/activate
pip install --upgrade pip
pip install -r tools/hpsim/requirements.txt
pip install -e tools/hpsim
```

> Needs root or `sudo setcap cap_net_raw,cap_net_admin+ep .venv/bin/python` to send raw frames.

## Usage

```bash
hpsim --interface eth0 --clients 10 --dst 10.0.0.5 --dport 80 --proto tcp --flags S --count 100 --interval 0.01
```

Key flags:
- `--subnet-pool` CIDR to allocate client IPs (defaults to interface subnet)
- `--rand-source` randomize client identity per packet
- `--rand-dest --dest-subnet 10.0.0.0/24` randomize destination IPs
- `--payload "deadbeef" --payload-hex` send custom payload
- `--flood` remove delay, `--dry-run` craft packets only, `--pcap-out out.pcap` write sent frames

### CLI parameters

- `--config PATH` load YAML/JSON defaults
- `--interface IFACE` interface to send on (required)
- `--dst IP` destination IP (required unless using `--dest-subnet`)
- `--dest-subnet CIDR` pool for random destination IPs
- `--clients N` number of simulated clients (default 1)
- `--subnet-pool CIDR` pool for client source IPs (defaults to interface subnet)
- `--proto {tcp,udp,icmp,igmp,gre,esp,ah,sctp}` protocol (default tcp)
- `--dport N` destination port (tcp/udp/sctp)
- `--sport N` source port (tcp/udp/sctp)
- `--flags STRING` TCP flags (default S)
- `--icmp-type N --icmp-code N` ICMP settings (default 8/0)
- `--ttl N` IP TTL (default 64), `--tos N` IP TOS (default 0), `--ip-id N` IP identification
- `--frag` enable fragmentation, `--frag-size N` fragment size bytes
- `--rand-source` randomize source identity per packet
- `--rand-dest` randomize destination per packet (uses `--dest-subnet` if provided)
- `--payload STRING` payload as text, `--payload-hex` interpret payload as hex
- `--count N` packets per client (0 = infinite)
- `--interval SECONDS` delay between packets (default 0.1); `--flood` removes delay
- `--pcap-out PATH` write sent frames to pcap
- `--dry-run` build packets only; `--verbose` print send/craft errors
- `--quiet` suppress periodic stats output

## Supported Protocols

- **TCP** - Transmission Control Protocol with customizable flags
- **UDP** - User Datagram Protocol
- **ICMP** - Internet Control Message Protocol (ping, etc.)
- **IGMP** - Internet Group Management Protocol (multicast)
- **GRE** - Generic Routing Encapsulation (tunneling)
- **ESP** - Encapsulating Security Payload (IPsec encryption)
- **AH** - Authentication Header (IPsec authentication)
- **SCTP** - Stream Control Transmission Protocol

## Development

### Running Tests

Install development dependencies:

```bash
pip install -e ".[dev]"
```

Run tests:

```bash
pytest
```

Run tests with coverage:

```bash
pytest --cov=hpsim --cov-report=html
```

### Test Structure

- `tests/test_config.py` - Configuration loading and validation
- `tests/test_identity.py` - Identity and MAC address generation
- `tests/test_packet_builder.py` - Packet construction for all protocols
- `tests/test_netinfo.py` - Network interface information
- `tests/test_cli.py` - Command-line interface

## Layout

- `hpsim/` package code
- `tests/` unit tests
- `pyproject.toml` packaging metadata
- `pytest.ini` test configuration
